<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--
 - Copyright (C) 2010 Google Inc.
 -
 - Licensed under the Apache License, Version 2.0 (the "License");
 - you may not use this file except in compliance with the License.
 - You may obtain a copy of the License at
 -
 -      http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
-->

<html>
  <head>
    <title>Trivial Caja Container</title>
    
    <!-- Provides rules for visually confining vdoc-body___ elements -->
    <link rel="stylesheet" href="caja-gadget.css" type="text/css">
    
    <!-- In production these can be all replaced by domita-minified.js -->
    <script src="http://caja.appspot.com/json_sans_eval.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/cajita.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/unicode.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/css-defs.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/html4-defs.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/html-sanitizer.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/html-emitter.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/bridal.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/domita.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/setup-valija.js"
            type="text/javascript"></script>
    <script src="http://caja.appspot.com/valija.out.js"
            type="text/javascript"></script>
  </head>

  <body>

    <h1>Trivial Caja Container</h1>
    
    <p>This is a Caja container page. Assuming everything works, there is a Caja
    gadget below. The orange border in this example indicates the boundaries of
    the area which is under the control of the gadget.</p>

    <div id="theGadget"
         style="position: relative; overflow: auto; /* constrain gadget to 
                                                       its area */
                border: .1em solid orange; padding: .2em;"
         class="theGadget___"></div>
    <!-- TODO(kpreid): Explain the significance of id and class. -->
    <script type="text/javascript">
        var root = document.getElementById("theGadget");
        
        // Start setting up imports.
        // “outers” is used by Valija.
        var imports = ___.copy(___.sharedImports);
        imports.outers = imports;
        
        // Create Domita (DOM taming, virtualized document) instance. Domita
        // will add the 'document' property to the provided imports object.
        // TODO(kpreid): explain the first and second arguments.
        //
        // The gadget gets no access to any HTML which is not a child of the
        // specified element. Domita pretends that that element is the <body>
        // of the virtual document the gadget is given.
        //
        // attachDocumentStub is from domita.js.
        attachDocumentStub('-' + root.className, {
            rewrite: function() {
                return null;
            }
        }, imports, root);

        // Create HTML-emitter for gadget's HTML and document.write -- this
        // should be done *after* Domita setup so that imports.document exists.
        //
        // HtmlEmitter is from domita-minified.js.
        imports.htmlEmitter___ = new HtmlEmitter(root, imports.document);

        // Create Valija (unrestricted-JavaScript emulation environment)
        // instance. Any module which makes use of Valija, which includes any
        // that is derived from a HTML file, needs an import named "$v".
        //
        // valijaMaker is defined in valija.out.js, but setup-valija.js
        // arranges for it to be exported as this global function. Since
        // valija.out.js is cajoled code, functions in it must be invoked in
        // this way.
        // TODO(kpreid): Shouldn't there be a prettier API for this?
        imports.$v = valijaMaker.CALL___(imports.outers);
        
        // Register the contents of imports as the environment for loading the
        // upcoming module file in. Note that the new module handler is global
        // mutable state!
        ___.getNewModuleHandler().setImports(imports);
    </script>

    <!-- Load the module file -->
    <script src="gadget-trivial.out.js" type="text/javascript"></script>
    
    <p>See comments in the source of this page for more information.</p>
</body> 
</html>